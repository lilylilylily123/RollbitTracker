import Pocketbase from "pocketbase";

const myLabels = ['2022-09-24', '2022-09-25', '2022-09-26', '2022-09-27', '2022-09-28', '2022-09-29', '2022-09-30', '2022-10-01', '2022-10-02', '2022-10-03', '2022-10-04', '2022-10-05', '2022-10-06', '2022-10-07', '2022-10-08', '2022-10-09', '2022-10-10', '2022-10-11', '2022-10-12', '2022-10-13', '2022-10-14', '2022-10-15', '2022-10-16', '2022-10-17', '2022-10-18', '2022-10-19', '2022-10-20', '2022-10-21', '2022-10-22', '2022-10-23', '2022-10-24', '2022-10-25', '2022-10-26', '2022-10-27', '2022-10-28', '2022-10-29', '2022-10-30', '2022-10-31', '2022-11-01', '2022-11-02', '2022-11-03', '2022-11-04', '2022-11-05', '2022-11-06', '2022-11-07', '2022-11-08', '2022-11-09', '2022-11-10', '2022-11-11', '2022-11-12', '2022-11-13', '2022-11-14', '2022-11-15', '2022-11-16', '2022-11-17', '2022-11-18', '2022-11-19', '2022-11-20', '2022-11-21', '2022-11-22', '2022-11-23', '2022-11-24', '2022-11-25', '2022-11-26', '2022-11-27', '2022-11-28', '2022-11-29', '2022-11-30', '2022-12-01', '2022-12-02', '2022-12-03', '2022-12-04', '2022-12-05', '2022-12-06', '2022-12-07', '2022-12-08', '2022-12-09', '2022-12-10', '2022-12-11', '2022-12-12', '2022-12-13', '2022-12-14', '2022-12-15', '2022-12-16', '2022-12-17', '2022-12-18', '2022-12-19', '2022-12-20', '2022-12-21', '2022-12-22', '2022-12-24', '2022-12-26', '2022-12-27', '2022-12-28', '2022-12-29', '2022-12-30', '2022-12-31', '2023-01-01', '2023-01-02', '2023-01-03', '2023-01-04', '2023-01-05', '2023-01-06', '2023-01-07', '2023-01-08', '2023-01-09', '2023-01-10', '2023-01-11', '2023-01-12', '2023-01-13', '2023-01-14', '2023-01-15', '2023-01-16', '2023-01-17', '2023-01-18', '2023-01-19', '2023-01-20', '2023-01-21', '2023-01-22', '2023-01-23', '2023-01-24', '2023-01-25', '2023-01-26', '2023-01-27', '2023-01-28', '2023-01-29', '2023-01-30', '2023-01-31', '2023-02-01', '2023-02-02', '2023-02-03', '2023-02-04', '2023-02-05', '2023-02-06', '2023-02-07', '2023-02-08', '2023-02-09', '2023-02-10', '2023-02-11', '2023-02-12', '2023-02-13', '2023-02-14', '2023-02-15', '2023-02-16', '2023-02-17', '2023-02-18', '2023-02-19', '2023-02-20', '2023-02-21', '2023-02-22', '2023-02-23', '2023-02-24', '2023-02-25', '2023-02-26', '2023-02-27', '2023-02-28', '2023-03-01', '2023-03-02', '2023-03-03', '2023-03-04', '2023-03-05', '2023-03-06', '2023-03-07', '2023-03-08', '2023-03-09', '2023-03-10', '2023-03-11', '2023-03-12', '2023-03-13', '2023-03-14', '2023-03-15', '2023-03-16', '2023-03-17', '2023-03-18', '2023-03-19', '2023-03-20', '2023-03-21', '2023-03-22', '2023-03-23', '2023-03-24', '2023-03-25', '2023-03-26', '2023-03-27', '2023-03-28', '2023-03-29', '2023-03-30', '2023-03-31', '2023-04-01', '2023-04-02', '2023-04-03', '2023-04-04', '2023-04-05', '2023-04-06', '2023-04-07']
const myValues = [171326.13999999993, 174699.65999999997, 177927.07, 180288.50999999998, 184788.40000000002, 190848.24999999997, 195522.09000000003, 201680.86, 215242.91999999998, 221658.19999999995, 222348.04999999996, 226629.51000000004, 234881.96000000005, 238129.01999999996, 238710.13, 242232.70000000007, 243695.30000000002, 242464.48, 241003.06999999998, 243929.52999999997, 243596.43000000002, 243132.75999999998, 244563.94000000003, 249770.09999999995, 249247.91000000003, 247947.02000000002, 250829.58, 254050.15000000002, 253000.83999999997, 256363.89999999994, 257713.52999999994, 250831.39, 246157.88, 245628.69000000006, 245694.50999999998, 241144.64, 240503.35000000003, 238139.59999999998, 225468.04, 219029.6, 217351.49999999997, 210500.77000000002, 200873.24000000002, 197438.30999999997, 196979.56000000006, 193070.14999999997, 192298.65999999997, 192033.75999999998, 189997.71000000005, 193296.85000000003, 201224.12, 208306.30999999997, 214028.63999999996, 220351.56, 231667.09999999998, 238405.32000000004, 237248.69999999995, 236097.64, 237159.67999999996, 229275.0, 234198.50999999995, 242368.00000000003, 245001.06999999995, 246170.4, 247751.49, 250211.09, 243550.59999999995, 243384.55999999994, 247138.38999999996, 253098.85000000006, 253118.66000000003, 255212.72, 259955.2, 259981.54, 259863.09, 262919.25, 261145.59000000003, 263426.09, 266462.5, 262211.0, 250163.09, 238488.61999999994, 234788.41999999998, 221553.63999999996, 212547.6, 209120.64999999997, 218377.79000000004, 213662.25, 213833.72, 218354.69, 198784.16, 202082.6, 211976.82999999996, 212688.24999999997, 214361.57, 214196.38000000003, 215752.36, 210406.9, 218474.93000000005, 215542.03, 212769.22999999998, 211228.80999999994, 210235.63000000003, 208548.71, 211500.74, 211739.82000000004, 208613.87000000002, 207455.67, 211692.98000000007, 211760.35000000003, 208394.54999999996, 210382.67000000004, 216065.32999999996, 214617.81000000003, 206159.33, 210462.47000000003, 208179.12999999998, 205104.69999999998, 208167.64, 214929.97999999998, 214460.17999999996, 213666.64, 199435.86000000007, 203933.21000000005, 203613.58000000005, 208175.82000000004, 216769.82, 218857.83000000002, 217429.66999999998, 221632.13000000006, 225102.64, 233157.02000000002, 237163.76, 251296.93, 251919.73, 255667.44999999995, 261594.93999999997, 266654.31, 282022.62999999995, 289841.42000000004, 310848.6700000001, 332128.3000000001, 333504.91999999987, 343961.4700000001, 358520.76, 368097.8999999998, 387731.6300000001, 402276.99999999994, 423542.8199999999, 427388.0800000001, 444697.3000000001, 463669.61, 501803.8700000001, 502125.87999999995, 527224.6699999999, 545179.5199999999, 553095.5599999999, 576980.39, 591622.96, 611776.46, 645839.6800000002, 687981.7300000002, 707422.27, 728714.2199999999, 761459.6699999999, 788363.3699999998, 818290.16, 852993.5200000003, 882234.4000000001, 880632.7699999998, 888952.55, 903824.9200000002, 903082.4699999999, 904023.9400000001, 917871.0800000001, 938067.91, 934221.2799999998, 927065.2599999998, 912872.36, 910442.5099999999, 900929.7799999998, 889815.98, 878980.0099999997, 868502.18, 841115.4499999998, 848328.5199999999, 838376.25, 829443.4599999998, 829082.66, 820691.2600000004, 791400.97, 750468.1799999997, 744255.8699999999, 718919.0900000001]
const pb = new Pocketbase("https://rollbit.pockethost.io")
export default async function handler(req, res) {
    await pb.admins.authWithPassword(process.env.DB_USER, process.env.DB_PASS);
    const record = await pb.collection("total_data").getFullList()
    let total = 0;
    await fetch('http://localhost:3000/api/total')
    .then((response) => response.json())
    .then((data) => {
        data.thing.forEach((item) => {
            total += item[2] * item[3];
        })
    })
    let todayDate = new Date().toISOString().slice(0, 10);
    const myOtherLabels = []
    const myOtherData = []
    Object.entries(record[0].historical).forEach((key, value) => {
        myOtherLabels.push(key[0])
        myOtherData.push(key[1])
    })
    myOtherLabels.push(todayDate)
    myOtherData.push(total)
    const myData = {}
    myOtherLabels.forEach((label, index) => {
        myData[label] = myOtherData[index];
    });
    const updatedRecord = await pb.collection("total_data").update(record[0].id, {historical: myData})
    res.status(200).json(updatedRecord);
}